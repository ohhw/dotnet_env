@page
@model App.Pages.IndexModel
@{
    ViewData["Title"] = "홈";
}

<!-- 메인 컨텐츠를 좌우로 분할 -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 100%; margin: 0; padding: 10px;">
    
    <!-- 좌측 영역: 기존 컨텐츠 -->
    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
        
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
            <h1 style="margin-bottom: 20px; font-size: 2.2em;">Hello, @(Model.UserName)님!</h1>
            
            @if (Model.UserName == "방문자")
            {
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <p style="margin-bottom: 15px; font-size: 1.1em;">👋 안녕하세요! 이름을 알려주시면 더 친근하게 인사드릴게요!</p>
                    <form method="post" style="display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap;">
                        @Html.AntiForgeryToken()
                        <input type="text" name="userName" placeholder="이름을 입력해주세요" required 
                               style="padding: 12px 16px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 200px; color: #333;">
                        <button type="submit" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            ✨ 인사하기
                        </button>
                    </form>
                </div>
            }
            else
            {
                <p style="font-size: 1.1em; opacity: 0.9;">환영합니다! 오늘도 좋은 하루 되세요! 🌟</p>
                <div style="margin-top: 15px;">
                    <a href="/" style="background: #007bff; color: white; padding: 12px 20px; text-decoration: none; border-radius: 5px; font-size: 14px;">
                        🏠 홈으로
                    </a>
                </div>
            }
        </div>

        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3 style="margin: 0 0 15px 0; color: #1976d2;">⏰ 현재 시간</h3>
            <div style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px;">
                @DateTime.Now.ToString("yyyy년 MM월 dd일")
            </div>
            <div style="font-size: 24px; font-weight: bold; color: #1976d2;">
                @DateTime.Now.ToString("HH:mm:ss")
            </div>
        </div>

        <div style="text-align: center; margin: 10px 0;">
            <button onclick="location.reload()" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin: 0 5px;">🔄 시간 새로고침</button>
            <button onclick="window.location.href='/Time'" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin: 0 5px;">🕐 시간 페이지</button>
            <button onclick="window.location.href='/Time?format=json'" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin: 0 5px;">📊 JSON 형식</button>
        </div>

        <div style="background: #e9ecef; padding: 15px; border-radius: 10px; margin: 20px 0;">
            <h3 style="margin: 0 0 15px 0; color: #495057;">📝 메모장</h3>
            
            <form method="post" style="margin-bottom: 15px;">
                @Html.AntiForgeryToken()
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" name="newMemo" placeholder="새 메모 추가..." required style="flex: 1; padding: 12px 16px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    <button type="submit" name="action" value="add" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">
                        ➕ 추가
                    </button>
                </div>
            </form>
            
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="window.location.href='/Memo'" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">📋 메모 페이지</button>
            </div>
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; border: 2px solid #dee2e6;">
            <h3 style="margin: 0 0 15px 0; color: #495057; text-align: center;">🧮 간단 계산기</h3>
            
            <div style="max-width: 400px; margin: 0 auto;">
                <input type="text" id="homeCalculatorInput" 
                       placeholder="계산식을 입력하세요 (예: 2+3*4, sin(30), sqrt(16))" 
                       style="width: 100%; padding: 12px 16px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; font-size: 14px; font-family: 'Courier New', monospace; text-align: center;">
                
                <div style="text-align: center; margin-bottom: 15px;">
                    <button onclick="calculateHomeExpression()" 
                            style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin-right: 10px;">
                        계산하기
                    </button>
                    <button onclick="clearHomeCalculator()" 
                            style="background: #dc3545; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                        지우기
                    </button>
                </div>
                
                <div id="homeCalculatorResult" style="background: #f8f9fa; color: #333; padding: 12px 16px; border-radius: 5px; text-align: center; font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-size: 14px; min-height: 25px; border: 1px solid #ddd; margin-bottom: 15px;">결과가 여기에 표시됩니다</div>
                
                <div style="text-align: center;">
                    <button onclick="window.location.href='/Calculator'" style="background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">🧮 고급 계산기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 우측 영역: 지도 관련 기능 (간소화) -->
    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
        
        <!-- 실시간 지도 (Google만) -->
        <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #e9ecef; margin-bottom: 20px;">
            <h3 style="color: #333; margin-bottom: 15px; text-align: center;">🗺️ 실시간 지도 (Google)</h3>
            <p id="mapDescription" style="text-align: center; color: #666; margin-bottom: 15px; font-size: 14px;">Google 지도 (실시간)</p>
            <iframe id="mapFrame" 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d25320.27!2d126.9780!3d37.5665!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x357ca2eb6b5ace79%3A0x5e0d96d2b6b08b12!2z7ISc7Jq4!5e0!3m2!1sko!2skr!4v1691234567890!5m2!1sko!2skr" 
                    width="100%" 
                    height="300" 
                    style="border: none; border-radius: 8px;"
                    allowfullscreen="" 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade">
            </iframe>
            <div style="text-align: center; margin-top: 10px;">
                <button onclick="switchToGoogle()" style="background: #4285f4; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">🔄 지도 새로고침</button>
            </div>
        </div>

        <!-- 경로 검색 (Google만) -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border: 1px solid #e9ecef; margin-bottom: 20px;">
            <h4 style="color: #333; margin-bottom: 15px; text-align: center;">📍 경로 검색 (Google)</h4>
            <div style="margin-bottom: 12px;">
                <input type="text" id="startLocation" placeholder="📍 출발지 입력" 
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; font-size: 14px;" />
            </div>
            <div style="margin-bottom: 15px;">
                <input type="text" id="endLocation" placeholder="🎯 도착지 입력" 
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; font-size: 14px;" />
            </div>
            <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                <button onclick="routeSearch()" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; padding: 12px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 2px 8px rgba(0,123,255,0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    🚗 Google 지도로 길찾기
                </button>
            </div>
        </div>

        <!-- 빠른 장소 검색 (3개 서비스) -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border: 1px solid #e9ecef;">
            <h4 style="color: #333; margin-bottom: 15px; text-align: center;">🔍 빠른 장소 검색</h4>
            <div style="margin-bottom: 15px;">
                <input type="text" id="quickSearchLocation" placeholder="장소를 입력하세요" 
                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                <button onclick="quickSearchGoogle()" style="background: #4285f4; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    🌍 Google
                </button>
                <button onclick="quickSearchNaver()" style="background: #03c75a; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    🟢 네이버
                </button>
                <button onclick="quickSearchKakao()" style="background: #fee500; color: #3c1e1e; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    🟡 카카오
                </button>
            </div>
        </div>
        
        <!-- 지도 페이지 이동 버튼 -->
        <div style="text-align: center; margin-top: 15px;">
            <button onclick="window.location.href='/Map'" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">🗺️ 지도 페이지</button>
        </div>
    </div>
</div>

<!-- 외부 JavaScript 파일 로드 -->
<script src="~/js/maps.js"></script>
<script src="~/js/calculator.js"></script>

<script>
    // 엔터키 이벤트 및 초기화
    document.addEventListener('DOMContentLoaded', function() {
        // 빠른 검색 엔터키 이벤트
        const quickSearchInput = document.getElementById('quickSearchLocation');
        if (quickSearchInput) {
            quickSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    quickSearchGoogle(); // 기본값으로 Google 검색
                }
            });
        }
        
        // 경로 검색 엔터키 이벤트
        const startInput = document.getElementById('startLocation');
        const endInput = document.getElementById('endLocation');
        
        if (startInput) {
            startInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    if (endInput) endInput.focus();
                }
            });
        }
        
        if (endInput) {
            endInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    routeSearch(); // 통합 경로 검색 함수 사용
                }
            });
        }
    });

    // 홈 화면 간단 계산기 함수들
    function calculateHomeExpression() {
        const input = document.getElementById('homeCalculatorInput');
        const result = document.getElementById('homeCalculatorResult');
        
        if (!input.value.trim()) {
            result.textContent = '계산식을 입력해주세요';
            result.style.color = '#ffc107';
            return;
        }
        
        try {
            let expression = input.value.trim();
            
            // 기본 수학 함수들 처리
            expression = expression.replace(/sin\(/g, 'Math.sin(Math.PI/180*');
            expression = expression.replace(/cos\(/g, 'Math.cos(Math.PI/180*');
            expression = expression.replace(/tan\(/g, 'Math.tan(Math.PI/180*');
            expression = expression.replace(/sqrt\(/g, 'Math.sqrt(');
            expression = expression.replace(/log\(/g, 'Math.log10(');
            expression = expression.replace(/ln\(/g, 'Math.log(');
            expression = expression.replace(/abs\(/g, 'Math.abs(');
            expression = expression.replace(/pow\(/g, 'Math.pow(');
            expression = expression.replace(/\^/g, '**');
            
            // 안전한 계산을 위해 Function 사용
            const calculationResult = Function(`"use strict"; return (${expression})`)();
            
            result.textContent = `= ${calculationResult}`;
            result.style.color = '#0f0';
        } catch (error) {
            result.textContent = '계산 오류: 올바른 식을 입력해주세요';
            result.style.color = '#dc3545';
        }
    }
    
    function clearHomeCalculator() {
        document.getElementById('homeCalculatorInput').value = '';
        document.getElementById('homeCalculatorResult').textContent = '결과가 여기에 표시됩니다';
        document.getElementById('homeCalculatorResult').style.color = '#0f0';
    }
    
    // Enter 키로 계산 실행
    document.addEventListener('DOMContentLoaded', function() {
        const input = document.getElementById('homeCalculatorInput');
        if (input) {
            input.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    calculateHomeExpression();
                }
            });
        }
    });
</script>
