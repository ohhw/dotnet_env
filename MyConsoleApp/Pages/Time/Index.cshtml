@page
@model MyConsoleApp.Pages.Time.IndexModel
@{
    ViewData["Title"] = "ì‹œê°„ ì •ë³´";
}

@if (Model.Format == "json")
{
    <div style="font-family: monospace; background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 600px;">
        <pre style="margin: 0; font-size: 14px;">@Model.JsonResponse</pre>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
        <a href="/Time" style="background:#007bff; color:#fff; padding:10px 20px; text-decoration:none; border-radius:5px; font-size:14px;">ğŸ• ì¼ë°˜ ì‹œê°„ í˜ì´ì§€ë¡œ</a>
        <a href="/" style="background:#6c757d; color:#fff; padding:10px 20px; text-decoration:none; border-radius:5px; font-size:14px; margin-left:10px;">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
}
else
{
    <div style="max-width: 800px; margin: 0 auto; text-align: center;">
        <h1>ğŸ• í˜„ì¬ ì‹œê°„ ì •ë³´</h1>
        
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 15px; margin: 30px 0; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
            <h2 id="current-time" style="font-size: 2.5em; margin-bottom: 10px;">@DateTime.Now.ToString("HH:mm:ss")</h2>
            <p id="current-date" style="font-size: 1.3em; margin-bottom: 5px;">@DateTime.Now.ToString("yyyyë…„ MMì›” ddì¼")</p>
            <p id="current-day" style="font-size: 1.1em; opacity: 0.9;">@DateTime.Now.ToString("dddd", new System.Globalization.CultureInfo("ko-KR"))</p>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
            <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 5px solid #2196f3;">
                <h3 style="color: #1976d2; margin-bottom: 10px;">ğŸ“… ë‚ ì§œ ì •ë³´</h3>
                <p><strong>ì „ì²´ ë‚ ì§œ:</strong> <span id="full-date">@DateTime.Now.ToString("yyyy-MM-dd")</span></p>
                <p><strong>ìš”ì¼:</strong> <span id="day-of-week">@DateTime.Now.ToString("dddd", new System.Globalization.CultureInfo("ko-KR"))</span></p>
                <p><strong>ë…„ë„:</strong> <span id="year">@(DateTime.Now.Year)</span>ë…„</p>
                <p><strong>ì›”:</strong> <span id="month">@(DateTime.Now.Month)</span>ì›”</p>
                <p><strong>ì¼:</strong> <span id="day">@(DateTime.Now.Day)</span>ì¼</p>
            </div>
            
            <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; border-left: 5px solid #9c27b0;">
                <h3 style="color: #7b1fa2; margin-bottom: 10px;">â° ì‹œê°„ ì •ë³´</h3>
                <p><strong>ì „ì²´ ì‹œê°„:</strong> <span id="full-time">@DateTime.Now.ToString("HH:mm:ss")</span></p>
                <p><strong>ì‹œ:</strong> <span id="hour">@(DateTime.Now.Hour)</span>ì‹œ</p>
                <p><strong>ë¶„:</strong> <span id="minute">@(DateTime.Now.Minute)</span>ë¶„</p>
                <p><strong>ì´ˆ:</strong> <span id="second">@(DateTime.Now.Second)</span>ì´ˆ</p>
                <p><strong>ë°€ë¦¬ì´ˆ:</strong> <span id="millisecond">@DateTime.Now.Millisecond</span></p>
            </div>
            
            <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border-left: 5px solid #4caf50;">
                <h3 style="color: #388e3c; margin-bottom: 10px;">ğŸŒ ì¶”ê°€ ì •ë³´</h3>
                <p><strong>UTC ì‹œê°„:</strong> <span id="utc-time">@DateTime.UtcNow.ToString("HH:mm:ss")</span></p>
                <p><strong>ì‹œê°„ëŒ€:</strong> <span id="timezone-info">ê°ì§€ ì¤‘...</span></p>
                <p><strong>ìœ ë‹‰ìŠ¤ íƒ€ì„ìŠ¤íƒ¬í”„:</strong> <span id="unix-timestamp">@((DateTimeOffset)DateTime.Now).ToUnixTimeSeconds()</span></p>
                <p><strong>ISO 8601:</strong> <span id="iso-8601">@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ssK")</span></p>
            </div>
        </div>
        
        <div style="margin: 30px 0;">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #495057; margin-bottom: 15px;">ğŸ• ì‹œê°„ëŒ€ ì„¤ì •</h3>
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <label for="timezone-selector" style="font-weight: bold;">ì‹œê°„ëŒ€ ì„ íƒ:</label>
                    <select id="timezone-selector" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 5px; font-size: 14px; min-width: 200px;">
                        <option value="auto">ìë™ ê°ì§€</option>
                        <option value="Asia/Seoul">í•œêµ­ (Seoul)</option>
                        <option value="Asia/Tokyo">ì¼ë³¸ (Tokyo)</option>
                        <option value="Asia/Shanghai">ì¤‘êµ­ (Shanghai)</option>
                        <option value="America/New_York">ë¯¸êµ­ ë™ë¶€ (New York)</option>
                        <option value="America/Los_Angeles">ë¯¸êµ­ ì„œë¶€ (Los Angeles)</option>
                        <option value="America/Chicago">ë¯¸êµ­ ì¤‘ë¶€ (Chicago)</option>
                        <option value="Europe/London">ì˜êµ­ (London)</option>
                        <option value="Europe/Paris">í”„ë‘ìŠ¤ (Paris)</option>
                        <option value="Europe/Berlin">ë…ì¼ (Berlin)</option>
                        <option value="Australia/Sydney">í˜¸ì£¼ (Sydney)</option>
                        <option value="UTC">UTC</option>
                    </select>
                    <button onclick="resetToAuto()" style="background: #28a745; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">
                        ğŸŒ ìë™ ê°ì§€ë¡œ ë¦¬ì…‹
                    </button>
                </div>
            </div>
            
            <button onclick="location.reload()" style="background: #ff9800; color: white; padding: 12px 25px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin: 5px;">
                ğŸ”„ ì‹œê°„ ìƒˆë¡œê³ ì¹¨
            </button>
            <a href="/Time?format=json" style="background: #607d8b; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-size: 16px; margin: 5px;">
                ğŸ“Š JSON í˜•ì‹ìœ¼ë¡œ ë³´ê¸°
            </a>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <a href="/" style="background:#6c757d; color:#fff; padding:10px 20px; text-decoration:none; border-radius:5px; font-size:14px;">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>
    
    <script>
        // ì‚¬ìš©ìì˜ ë¡œì¼€ì¼ê³¼ ì‹œê°„ëŒ€ ìë™ ê°ì§€
        const userLocale = navigator.language || 'ko-KR';
        let currentTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œê°„ëŒ€ ì„ íƒê¸° ì´ˆê¸°í™”
        function initializeTimezoneSelector() {
            const selector = document.getElementById('timezone-selector');
            
            // ìë™ ê°ì§€ëœ ì‹œê°„ëŒ€ê°€ ëª©ë¡ì— ìˆìœ¼ë©´ ì„ íƒ
            for (let option of selector.options) {
                if (option.value === currentTimezone) {
                    option.selected = true;
                    break;
                }
            }
            
            // ì‹œê°„ëŒ€ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            selector.addEventListener('change', function() {
                if (this.value === 'auto') {
                    currentTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                } else {
                    currentTimezone = this.value;
                }
                updateTime(); // ì¦‰ì‹œ ì‹œê°„ ì—…ë°ì´íŠ¸
            });
        }
        
        // ìë™ ê°ì§€ë¡œ ë¦¬ì…‹ í•¨ìˆ˜
        function resetToAuto() {
            currentTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            document.getElementById('timezone-selector').value = 'auto';
            updateTime();
        }
        
        function updateTime() {
            const now = new Date();
            const utcNow = new Date(now.getTime() + (now.getTimezoneOffset() * 60000));
            
            // ì‹œê°„ í¬ë§·íŒ… í•¨ìˆ˜
            function pad(num) {
                return num.toString().padStart(2, '0');
            }
            
            // ì„ íƒëœ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ í¬ë§·íŒ…
            const timeString = now.toLocaleTimeString(userLocale, { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                timeZone: currentTimezone
            });
            
            const dateString = now.toLocaleDateString(userLocale, {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                timeZone: currentTimezone
            });
            
            const dayString = now.toLocaleDateString(userLocale, {
                weekday: 'long',
                timeZone: currentTimezone
            });
            
            // ë©”ì¸ ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('current-time').textContent = timeString;
            document.getElementById('current-date').textContent = dateString;
            document.getElementById('current-day').textContent = dayString;
            
            // ê°œë³„ ë‚ ì§œ/ì‹œê°„ ê°’ë“¤ì„ ì„ íƒëœ ì‹œê°„ëŒ€ë¡œ ê³„ì‚°
            const localDate = new Date(now.toLocaleString('en-US', { timeZone: currentTimezone }));
            
            // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
            const fullDateString = localDate.getFullYear() + '-' + 
                                 pad(localDate.getMonth() + 1) + '-' + 
                                 pad(localDate.getDate());
            document.getElementById('full-date').textContent = fullDateString;
            document.getElementById('day-of-week').textContent = dayString;
            document.getElementById('year').textContent = localDate.getFullYear();
            document.getElementById('month').textContent = localDate.getMonth() + 1;
            document.getElementById('day').textContent = localDate.getDate();
            
            // ì‹œê°„ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('full-time').textContent = timeString;
            document.getElementById('hour').textContent = localDate.getHours();
            document.getElementById('minute').textContent = localDate.getMinutes();
            document.getElementById('second').textContent = localDate.getSeconds();
            document.getElementById('millisecond').textContent = localDate.getMilliseconds();
            
            // UTC ì‹œê°„ ì—…ë°ì´íŠ¸
            const utcTimeString = `${pad(utcNow.getHours())}:${pad(utcNow.getMinutes())}:${pad(utcNow.getSeconds())}`;
            document.getElementById('utc-time').textContent = utcTimeString;
            document.getElementById('unix-timestamp').textContent = Math.floor(now.getTime() / 1000);
            
            // ISO 8601 í˜•ì‹ ì—…ë°ì´íŠ¸ (ì„ íƒëœ ì‹œê°„ëŒ€ í¬í•¨)
            const tempDate = new Date(now.toLocaleString('en-US', { timeZone: currentTimezone }));
            const offset = getTimezoneOffset(tempDate, currentTimezone);
            const isoString = `${tempDate.getFullYear()}-${pad(tempDate.getMonth() + 1)}-${pad(tempDate.getDate())}T${pad(tempDate.getHours())}:${pad(tempDate.getMinutes())}:${pad(tempDate.getSeconds())}${offset}`;
            document.getElementById('iso-8601').textContent = isoString;
            
            // ì‹œê°„ëŒ€ ì •ë³´ ì—…ë°ì´íŠ¸
            updateTimezoneDisplay();
        }
        
        // ì‹œê°„ëŒ€ ì˜¤í”„ì…‹ ê³„ì‚° (íŠ¹ì • ì‹œê°„ëŒ€ìš©)
        function getTimezoneOffset(date, timezone) {
            const utcTime = new Date(date.toLocaleString('en-US', { timeZone: 'UTC' }));
            const localTime = new Date(date.toLocaleString('en-US', { timeZone: timezone }));
            const offset = (localTime.getTime() - utcTime.getTime()) / (1000 * 60);
            
            const hours = Math.floor(Math.abs(offset) / 60);
            const minutes = Math.abs(offset) % 60;
            const sign = offset >= 0 ? '+' : '-';
            return sign + pad(hours) + ':' + pad(minutes);
        }
        
        // ì‹œê°„ëŒ€ ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateTimezoneDisplay() {
            const timezoneElement = document.getElementById('timezone-info');
            if (timezoneElement) {
                const now = new Date();
                const tempDate = new Date(now.toLocaleString('en-US', { timeZone: currentTimezone }));
                const offset = getTimezoneOffset(tempDate, currentTimezone);
                
                // ì‹œê°„ëŒ€ ì´ë¦„ì„ ë” ì¹œê·¼í•˜ê²Œ í‘œì‹œ
                let displayName = currentTimezone;
                if (currentTimezone === 'Asia/Seoul') displayName = 'í•œêµ­ í‘œì¤€ì‹œ (KST)';
                else if (currentTimezone === 'Asia/Tokyo') displayName = 'ì¼ë³¸ í‘œì¤€ì‹œ (JST)';
                else if (currentTimezone === 'America/New_York') displayName = 'ë¯¸êµ­ ë™ë¶€ì‹œê°„ (EST/EDT)';
                else if (currentTimezone === 'America/Los_Angeles') displayName = 'ë¯¸êµ­ ì„œë¶€ì‹œê°„ (PST/PDT)';
                else if (currentTimezone === 'Europe/London') displayName = 'ì˜êµ­ì‹œê°„ (GMT/BST)';
                else if (currentTimezone === 'UTC') displayName = 'í˜‘ì • ì„¸ê³„ì‹œ (UTC)';
                
                timezoneElement.textContent = `${displayName} (UTC${offset})`;
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeTimezoneSelector();
            updateTime();
            
            // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(updateTime, 1000);
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰ (DOMContentLoaded ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šì€ ê²½ìš°ë¥¼ ìœ„í•´)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializeTimezoneSelector();
                updateTime();
            });
        } else {
            initializeTimezoneSelector();
            updateTime();
        }
        
        // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
        setInterval(updateTime, 1000);
    </script>
}
